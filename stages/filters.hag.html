


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>filters.hag &mdash; pdal.io</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/breathe.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="../about.html"/>
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="pdal.io" href="../index.html"/>
        <link rel="up" title="Filters" href="filters.html"/>
        <link rel="next" title="filters.kdistance" href="filters.kdistance.html"/>
        <link rel="prev" title="filters.ferry" href="filters.ferry.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> PDAL
          

          
          </a>

          
            
            
              <div class="version">
                1.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../download.html">Download</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apps/index.html">Applications</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community.html">Community</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pipeline.html">Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="readers.html">Readers</a></li>
<li class="toctree-l1"><a class="reference internal" href="writers.html">Writers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="filters.html">Filters</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="filters.html#create">Create</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="filters.approximatecoplanar.html">filters.approximatecoplanar</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.assign.html">filters.assign</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.cluster.html">filters.cluster</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.colorinterp.html">filters.colorinterp</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.colorization.html">filters.colorization</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.eigenvalues.html">filters.eigenvalues</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.estimaterank.html">filters.estimaterank</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.elm.html">filters.elm</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.ferry.html">filters.ferry</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">filters.hag</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example-1">Example #1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-2">Example #2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-3">Example #3</a></li>
<li class="toctree-l4"><a class="reference internal" href="#options">Options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="filters.kdistance.html">filters.kdistance</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.lof.html">filters.lof</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.mongus.html">filters.mongus</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.neighborclassifier.html">filters.neighborclassifier</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.normal.html">filters.normal</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.outlier.html">filters.outlier</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.overlay.html">filters.overlay</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.pmf.html">filters.pmf</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.radialdensity.html">filters.radialdensity</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.smrf.html">filters.smrf</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="filters.html#order">Order</a></li>
<li class="toctree-l2"><a class="reference internal" href="filters.html#move">Move</a></li>
<li class="toctree-l2"><a class="reference internal" href="filters.html#cull">Cull</a></li>
<li class="toctree-l2"><a class="reference internal" href="filters.html#new">New</a></li>
<li class="toctree-l2"><a class="reference internal" href="filters.html#join">Join</a></li>
<li class="toctree-l2"><a class="reference internal" href="filters.html#metadata">Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="filters.html#mesh">Mesh</a></li>
<li class="toctree-l2"><a class="reference internal" href="filters.html#languages">Languages</a></li>
<li class="toctree-l2"><a class="reference internal" href="filters.html#other">Other</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dimensions.html">Dimensions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../python.html">Python</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorials</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../workshop/index.html">Workshop</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project/index.html">Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../copyright.html">License</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">PDAL</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Home</a> &raquo;</li>
      
        <li><a href="filters.html">Filters</a> &raquo;</li>
      
    <li>filters.hag</li>
    <li class="wy-breadcrumbs-aside">
      
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="filters-hag">
<span id="id1"></span><h1>filters.hag<a class="headerlink" href="#filters-hag" title="Permalink to this headline">¶</a></h1>
<p>The Height Above Ground (HAG) filter takes as input a point cloud with a
Classification dimension, with ground points assigned the classification label
of 2 (per LAS specification).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We expect ground returns to have the classification value of 2 in keeping
with the ASPRS Standard LIDAR Point Classes (see
<a class="reference external" href="http://www.asprs.org/a/society/committees/standards/LAS_1_4_r13.pdf">http://www.asprs.org/a/society/committees/standards/LAS_1_4_r13.pdf</a>).</p>
</div>
<p>This could, for example, be generated by <a class="reference internal" href="filters.pmf.html#filters-pmf"><span class="std std-ref">filters.pmf</span></a> or
<a class="reference internal" href="filters.smrf.html#filters-smrf"><span class="std std-ref">filters.smrf</span></a> (see <a class="reference internal" href="../tutorial/pcl_ground/index.html#pcl-ground"><span class="std std-ref">Identifying ground returns using ProgressiveMorphologicalFilter segmentation</span></a>), but you can use whichever method
you choose, as long as the ground returns are marked.</p>
<p>It returns a point cloud with a new dimension <code class="docutils literal"><span class="pre">HeightAboveGround</span></code> that
contains the normalized height value.</p>
<p>Normalized heights are a commonly used attribute of point cloud data. This can
also be referred to as <em>height above ground</em> (HAG) or <em>above ground level</em> (AGL)
heights. In the end, it is simply a measure of a point’s relative height as
opposed to its raw elevation value.</p>
<p>The HAG filter works by iterating through all points, finding the nearest
neighbor (in XY only) amongst the ground points, and computing the distance
between the two Z values.</p>
<p>The process of computing normalized heights is straightforward. First, we must
have an estimate of the underlying terrain model. With this we can compute the
difference between each point’s elevation and the elevation of the terrain model
at the same XY coordinate. The quality of the normalized heights will be a
function of the quality of the terrain model, which of course depends on the
quality of the ground segmentation approach and any interpolation that is
required to arrive at the terrain elevation for a given XY coordinate. We will
use a nearest neighbor interpolation scheme to estimate terrain elevations.</p>
<p>To compute the normalized heights, we first create a 2D KdTree (X and Y only) to
accelerate our nearest neighbor search. The tree is composed of only ground
returns. We then iterate over each of our points, searching for the nearest
neighbor in the ground points. We then compute the difference between the
elevation of the query point and the nearest neighbor in the ground set. This
value is encoded as a new dimension called <code class="docutils literal"><span class="pre">HeightAboveGround</span></code>.</p>
<div class="admonition embed" id="embed-0">
<p class="first admonition-title">Default Embedded Stage </p>
<p class="last">This stage is enabled by default</p>
</div>
<div class="section" id="example-1">
<h2>Example #1<a class="headerlink" href="#example-1" title="Permalink to this headline">¶</a></h2>
<p>Using the autzen dataset (here shown colored by elevation)</p>
<a class="reference internal image-reference" href="../_images/autzen-elevation.png"><img alt="../_images/autzen-elevation.png" src="../_images/autzen-elevation.png" style="height: 400px;" /></a>
<p>we execute the following pipeline</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;pipeline&quot;</span><span class="p">:[</span>
    <span class="s2">&quot;autzen.laz&quot;</span><span class="p">,</span>
    <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;filters.hag&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;writers.bpf&quot;</span><span class="p">,</span>
      <span class="nt">&quot;filename&quot;</span><span class="p">:</span><span class="s2">&quot;autzen-height.bpf&quot;</span><span class="p">,</span>
      <span class="nt">&quot;output_dims&quot;</span><span class="p">:</span><span class="s2">&quot;X,Y,Z,HeightAboveGround&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>which is equivalent to the <code class="docutils literal"><span class="pre">pdal</span> <span class="pre">translate</span></code> command</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdal translate autzen.laz autzen-height.bpf hag \
    --writers.bpf.output_dims=&quot;X,Y,Z,HeightAboveGround&quot;
</pre></div>
</div>
<p>In either case, the result, when colored by the normalized height instead of
elevation is</p>
<a class="reference internal image-reference" href="../_images/autzen-height.png"><img alt="../_images/autzen-height.png" src="../_images/autzen-height.png" style="height: 400px;" /></a>
</div>
<div class="section" id="example-2">
<h2>Example #2<a class="headerlink" href="#example-2" title="Permalink to this headline">¶</a></h2>
<p>In the previous example, we chose a <a class="reference internal" href="writers.bpf.html#writers-bpf"><span class="std std-ref">writer</span></a> that could
output custom dimensions. If you’d instead like to overwrite your Z values, then
follow the height filter with <a class="reference internal" href="filters.ferry.html#filters-ferry"><span class="std std-ref">filters.ferry</span></a> as shown</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;pipeline&quot;</span><span class="p">:[</span>
    <span class="s2">&quot;autzen.laz&quot;</span><span class="p">,</span>
    <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;filters.hag&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;filters.ferry&quot;</span><span class="p">,</span>
      <span class="nt">&quot;dimensions&quot;</span><span class="p">:</span><span class="s2">&quot;HeightAboveGround=Z&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;autzen-height-as-Z.laz&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>which is equivalent to the command</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdal translate autzen.laz autzen-height-as-Z.laz hag ferry \
    --filters.ferry.dimensions=&quot;HeightAboveGround=Z&quot;
</pre></div>
</div>
</div>
<div class="section" id="example-3">
<h2>Example #3<a class="headerlink" href="#example-3" title="Permalink to this headline">¶</a></h2>
<p>If you don’t yet have points classified as ground, start with <a class="reference internal" href="filters.pmf.html#filters-pmf"><span class="std std-ref">filters.pmf</span></a>
or <a class="reference internal" href="filters.smrf.html#filters-smrf"><span class="std std-ref">filters.smrf</span></a> to label ground returns, as shown</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;pipeline&quot;</span><span class="p">:[</span>
    <span class="s2">&quot;autzen.laz&quot;</span><span class="p">,</span>
    <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;filters.smrf&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;filters.hag&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;filters.ferry&quot;</span><span class="p">,</span>
      <span class="nt">&quot;dimensions&quot;</span><span class="p">:</span><span class="s2">&quot;HeightAboveGround=Z&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;autzen-height-as-Z-smrf.laz&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>which is once again equivalent to the command</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdal translate autzen.laz autzen-height-as-Z-smrf.bpf smrf hag ferry \
    --filters.ferry.dimensions=&quot;HeightAboveGround=Z&quot;
</pre></div>
</div>
</div>
<div class="section" id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="filters.kdistance.html" class="btn btn-neutral float-right" title="filters.kdistance" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="filters.ferry.html" class="btn btn-neutral" title="filters.ferry" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
                    &copy;  2018
                        <a href="https://github.com/abellgithub">Andrew Bell</a>,
                        <a href="https://github.com/chambbj">Brad Chambers</a>,
                        <a href="http://github.com/hobu">Howard Butler</a>,
                        <a href="http://github.com/mpgerlek">Michael Gerlek</a>,
                        and
                        <a href="https://github.com/PDAL/PDAL/graphs/contributors">others</a>.
      Last updated on Apr 06, 2018.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.7.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
    <div class="footer">
        <div class="container">
                    &copy;  2018
                        <a href="http://github.com/hobu">Howard Butler</a>,
                        <a href="http://github.com/mpgerlek">Michael Gerlek</a>,
                        and
                        <a href="https://github.com/PDAL/PDAL/graphs/contributors">others</a>,
                Last updated
                    on Apr 06, 2018.
        </div>
    </div>

</body>
</html>
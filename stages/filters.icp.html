


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>filters.icp &mdash; pdal.io</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  
    <link rel="canonical" href="https://pdal.io/stages/filters.icp.html"/>
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/pdal.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/breathe.css" type="text/css" />
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="filters.projpipeline" href="filters.projpipeline.html" />
    <link rel="prev" title="filters.cpd" href="filters.cpd.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> PDAL
          

          
          </a>

          
            
            
              <div class="version">
                2.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../download.html">Download</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apps/index.html">Applications</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community.html">Community</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pipeline.html">Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="readers.html">Readers</a></li>
<li class="toctree-l1"><a class="reference internal" href="writers.html">Writers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="filters.html">Filters</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="filters.html#create">Create</a></li>
<li class="toctree-l2"><a class="reference internal" href="filters.html#order">Order</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="filters.html#move">Move</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="filters.cpd.html">filters.cpd</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">filters.icp</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#examples">Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#options">Options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="filters.projpipeline.html">filters.projpipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.reprojection.html">filters.reprojection</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.transformation.html">filters.transformation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="filters.html#cull">Cull</a></li>
<li class="toctree-l2"><a class="reference internal" href="filters.html#new">New</a></li>
<li class="toctree-l2"><a class="reference internal" href="filters.html#join">Join</a></li>
<li class="toctree-l2"><a class="reference internal" href="filters.html#metadata">Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="filters.html#mesh">Mesh</a></li>
<li class="toctree-l2"><a class="reference internal" href="filters.html#languages">Languages</a></li>
<li class="toctree-l2"><a class="reference internal" href="filters.html#other">Other</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dimensions.html">Dimensions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../types.html">Types</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../python.html">Python</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../java.html">Java</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorials</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../workshop/index.html">Workshop</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project/index.html">Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../copyright.html">License</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PDAL</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html"> Documentation </a> &raquo;</li>
      
          <li><a href="filters.html">Filters</a> &raquo;</li>
      
      <li>filters.icp</li>
    

    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/PDAL/PDAL/edit//master/doc/stages/filters.icp.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="filters.projpipeline.html" class="btn btn-neutral float-right" title="filters.projpipeline" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="filters.cpd.html" class="btn btn-neutral float-left" title="filters.cpd" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="filters-icp">
<span id="id1"></span><h1>filters.icp<a class="headerlink" href="#filters-icp" title="Permalink to this headline">¶</a></h1>
<p>The <strong>ICP filter</strong> uses the Iterative Closest Point (ICP) algorithm to
calculate a <strong>rigid</strong> (rotation and translation) transformation that best
aligns two datasets.  The first input to the ICP filter is considered the
“fixed” points, and all subsequent points are “moving” points.  The output from
the filter are the “moving” points after the calculated transformation has been
applied, one point view per input.  The transformation matrix is inserted into
the stage’s metadata.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ICP requires the initial pose of the two point sets to be adequately close,
which is not always possible, especially when the transformation is
non-rigid.  ICP can handle limited non-rigid transformations but be aware
ICP may be unable to escape a local minimum. Consider using CPD instead.</p>
<p>From <span>[Xuechen2019]</span>:</p>
<p>ICP starts with an initial guess of the transformation between the two
point sets and then iterates between finding the correspondence under the
current transformation and updating the transformation with the newly found
correspondence. ICP is widely used because it is rather straightforward and
easy to implement in practice; however, its biggest problem is that it does
not guarantee finding the globally optimal transformation. In fact, ICP
converges within a very small basin in the parameter space, and it easily
becomes trapped in local minima. Therefore, the results of ICP are very
sensitive to the initialization, especially when high levels of noise and
large proportions of outliers exist.</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="s2">&quot;fixed.las&quot;</span><span class="p">,</span>
    <span class="s2">&quot;moving.las&quot;</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;filters.icp&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;output.las&quot;</span>
<span class="p">]</span>
</pre></div>
</div>
<p>To get the transform matrix, you’ll need to use the <code class="docutils literal notranslate"><span class="pre">--metadata</span></code> option
from the pipeline command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pdal pipeline icp-pipeline.json --metadata icp-metadata.json
</pre></div>
</div>
<p>The metadata output might start something like:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;stages&quot;</span><span class="p">:</span>
    <span class="p">{</span>
        <span class="nt">&quot;filters.icp&quot;</span><span class="p">:</span>
        <span class="p">{</span>
            <span class="nt">&quot;centroid&quot;</span><span class="p">:</span> <span class="s2">&quot;    583394  5.2831e+06   498.152&quot;</span><span class="p">,</span>
            <span class="nt">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nt">&quot;fitness&quot;</span><span class="p">:</span> <span class="mf">0.01953125097</span><span class="p">,</span>
            <span class="nt">&quot;transform&quot;</span><span class="p">:</span> <span class="s2">&quot;           1  2.60209e-18 -1.97906e-09       -0.375  8.9407e-08            1  5.58794e-09      -0.5625 6.98492e -10 -5.58794e-09            1   0.00411987           0            0            0            1&quot;</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>To apply this transformation to other points, the centroid and transform
metadata items can by used with filters.transform in another pipeline.  First,
move the centroid of the points to (0,0,0), then apply the transform, then move
the points back to the original location.  For the above metadata, the pipeline
would be similar to:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;readers.las&quot;</span><span class="p">,</span>
        <span class="nt">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;in.las&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;filters.transformation&quot;</span><span class="p">,</span>
        <span class="nt">&quot;matrix&quot;</span><span class="p">:</span> <span class="s2">&quot;1 0 0 -583394   0 1 0 -5.2831e+06   0 0 1 -498.152   0 0 0 1&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;filters.transformation&quot;</span><span class="p">,</span>
        <span class="nt">&quot;matrix&quot;</span><span class="p">:</span> <span class="s2">&quot;1  2.60209e-18 -1.97906e-09       -0.375  8.9407e-08            1  5.58794e-09      -0.5625 6.98492e -10 -5.58794e-09            1   0.00411987           0            0            0            1&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;filters.transformation&quot;</span><span class="p">,</span>
        <span class="nt">&quot;matrix&quot;</span><span class="p">:</span> <span class="s2">&quot;1 0 0 583394   0 1 0 5.2831e+06  0 0 1 498.152  0 0 0 1&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;writers.las&quot;</span><span class="p">,</span>
        <span class="nt">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;out.las&quot;</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="filters.transformation.html#filters-transformation"><span class="std std-ref">filters.transformation</span></a> to apply a transform to other points.
<a class="reference internal" href="filters.cpd.html#filters-cpd"><span class="std std-ref">filters.cpd</span></a> for the use of a probabilistic assignment of correspondences between pointsets.</p>
</div>
</div>
<div class="section" id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt>max_iter</dt><dd><p>Maximum number of iterations. [Default: <strong>100</strong>]</p>
</dd>
<dt>max_similar</dt><dd><p>Max number of similar transforms to consider converged. [Default: <strong>0</strong>]</p>
</dd>
<dt>mse_abs</dt><dd><p>Absolute threshold for MSE. [Default: <strong>1e-12</strong>]</p>
</dd>
<dt>rt</dt><dd><p>Rotation threshold. [Default: <strong>0.99999</strong>]</p>
</dd>
<dt>tt</dt><dd><p>Translation threshold. [Default: <strong>9e-8</strong>]</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="filters.projpipeline.html" class="btn btn-neutral float-right" title="filters.projpipeline" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="filters.cpd.html" class="btn btn-neutral float-left" title="filters.cpd" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <div class="info">
      <a class="logo-link" href="https://hobu.co">
        <div class="hobu-logo"></div>
      </a>
      <div class="copyright">
      

                    &copy;  2020
                        <a href="https://github.com/abellgithub">Andrew Bell</a>,
                        <a href="https://github.com/chambbj">Brad Chambers</a>,
                        <a href="http://github.com/hobu">Howard Butler</a>,
                        and
                        <a href="https://github.com/PDAL/PDAL/graphs/contributors">others</a>.

      
      Last updated on Apr 08, 2020.
      </div>
    </div>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
    <div class="footer">
        <div class="container">
                    &copy;  2020
                        <a href="http://github.com/hobu">Howard Butler</a>,
                        <a href="http://github.com/mpgerlek">Michael Gerlek</a>,
                        and
                        <a href="https://github.com/PDAL/PDAL/graphs/contributors">others</a>,
                Last updated
                    on Apr 08, 2020.
        </div>
    </div>

</body>
</html>
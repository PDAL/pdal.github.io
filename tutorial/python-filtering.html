


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Filtering Data with Python &mdash; pdal.io</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/breathe.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="../about.html"/>
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="pdal.io" href="../index.html"/>
        <link rel="up" title="Tutorials" href="index.html"/>
        <link rel="next" title="Point Cloud Processing and Analysis with PDAL" href="../workshop/index.html"/>
        <link rel="prev" title="Performing Poisson Sampling of Point Clouds Using Dart Throwing" href="sampling/index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> PDAL
          

          
          </a>

          
            
            
              <div class="version">
                1.6.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../download.html">Download</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apps/index.html">Applications</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community.html">Community</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pipeline.html">Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stages/readers.html">Readers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stages/writers.html">Writers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stages/filters.html">Filters</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dimensions.html">Dimensions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../python.html">Python</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="reading.html">Reading with PDAL</a></li>
<li class="toctree-l2"><a class="reference internal" href="las.html">LAS Reading and Writing with PDAL</a></li>
<li class="toctree-l2"><a class="reference internal" href="pcl_block_tutorial.html">Filtering data with PCL</a></li>
<li class="toctree-l2"><a class="reference internal" href="pcl_ground/index.html">Identifying ground returns using ProgressiveMorphologicalFilter segmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="clipping/index.html">Clipping with Geometries</a></li>
<li class="toctree-l2"><a class="reference internal" href="sampling/index.html">Performing Poisson Sampling of Point Clouds Using Dart Throwing</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Filtering Data with Python</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-challenge">The Challenge</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#processing-stategy">Processing Stategy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#python-filter">Python Filter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pdal-pipeline">PDAL Pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#docker">Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#final-script">Final Script</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../workshop/index.html">Workshop</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../copyright.html">License</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">PDAL</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Home</a> &raquo;</li>
      
        <li><a href="index.html">Tutorials</a> &raquo;</li>
      
    <li>Filtering Data with Python</li>
    <li class="wy-breadcrumbs-aside">
      
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="filtering-data-with-python">
<h1><a class="toc-backref" href="#id1">Filtering Data with Python</a><a class="headerlink" href="#filtering-data-with-python" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Howard Butler</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body"><a class="reference external" href="mailto:howard&#37;&#52;&#48;hobu&#46;co">howard<span>&#64;</span>hobu<span>&#46;</span>co</a></td>
</tr>
<tr class="field-odd field"><th class="field-name">Date:</th><td class="field-body">5/12/2017</td>
</tr>
</tbody>
</table>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#filtering-data-with-python" id="id1">Filtering Data with Python</a><ul>
<li><a class="reference internal" href="#introduction" id="id2">Introduction</a></li>
<li><a class="reference internal" href="#the-challenge" id="id3">The Challenge</a></li>
<li><a class="reference internal" href="#python-filter" id="id4">Python Filter</a></li>
<li><a class="reference internal" href="#pdal-pipeline" id="id5">PDAL Pipeline</a></li>
<li><a class="reference internal" href="#docker" id="id6">Docker</a></li>
<li><a class="reference internal" href="#final-script" id="id7">Final Script</a></li>
</ul>
</li>
</ul>
</div>
<p>This tutorial will describe using <a class="reference internal" href="../stages/filters.python.html#filters-python"><span class="std std-ref">filters.python</span></a> to identify
outlier points in an LAS file.</p>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id2">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Noise filtering is a primary challenge in point cloud processing. There are
many stock options available to you in PDAL to achieve it. These include:</p>
<ul class="simple">
<li><a class="reference internal" href="../stages/filters.iqr.html#filters-iqr"><span class="std std-ref">filters.iqr</span></a></li>
<li><a class="reference internal" href="../stages/filters.elm.html#filters-elm"><span class="std std-ref">filters.elm</span></a></li>
<li><a class="reference internal" href="../stages/filters.outlier.html#filters-outlier"><span class="std std-ref">filters.outlier</span></a></li>
</ul>
<p>These filters remove points that are deemed outliers in different ways.
The don&#8217;t, however, identify specific points. Python plus <a class="reference external" href="http://www.numpy.org/">NumPy</a> would
be a very quick way to prototype a tool that identified specific points
we would like to filter.</p>
<p>PDAL has three different ways to manipulate data with Python. The first is
<a class="reference internal" href="../stages/filters.python.html#filters-python"><span class="std std-ref">filters.python</span></a>, which we will be using in this tutorial.
The second is the Python extension at
<a class="reference external" href="https://pypi.python.org/pypi/PDAL">https://pypi.python.org/pypi/PDAL</a> that allows you to utilize PDAL processing
operations in your own Python programs.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../python.html#python"><span class="std std-ref">Python</span></a> describes PDAL&#8217;s Python story in more detail.</p>
</div>
</div>
<div class="section" id="the-challenge">
<h2><a class="toc-backref" href="#id3">The Challenge</a><a class="headerlink" href="#the-challenge" title="Permalink to this headline">¶</a></h2>
<p>We have a <a class="reference external" href="http://www.asprs.org/Committee-General/LASer-LAS-File-Format-Exchange-Activities.html">ASPRS LAS</a> file that has some points that that are completely out of
range and have bad <code class="docutils literal"><span class="pre">Y</span></code> values. We don&#8217;t know how those points got in the
file, but we want to identify <strong>which</strong> points they were, because it might be
some indication about a failure point in our processing operation. We could
simply use <a class="reference internal" href="../stages/filters.mad.html#filters-mad"><span class="std std-ref">filters.mad</span></a> to remove these with stock PDAL operations,
but that filter doesn&#8217;t tell us which points it removed. Our own custom Python
filter can do this for us.</p>
<div class="section" id="processing-stategy">
<h3>Processing Stategy<a class="headerlink" href="#processing-stategy" title="Permalink to this headline">¶</a></h3>
<p>The technique that <a class="reference internal" href="../stages/filters.mad.html#filters-mad"><span class="std std-ref">filters.mad</span></a> uses will suit our problem. In short,
we want to identify which points have Y values that are more than three standard
deviations away from the median. We are going to print a <a class="reference external" href="https://en.wikipedia.org/wiki/JSON">JSON</a> object that will
contain our information, which we can then use in some downstream processing
operation (as filtered with the <a class="reference external" href="https://stedolan.github.io/jq/">jq</a> command line utility).</p>
<p>We also want to use <a class="reference internal" href="../quickstart.html#docker"><span class="std std-ref">Install Docker</span></a> to process our data with a <a class="reference external" href="https://en.wikipedia.org/wiki/Bash_(Unix_shell)">Bash</a> script. We want to know
for sure that we&#8217;re using PDAL&#8217;s standard release (<code class="docutils literal"><span class="pre">1.5</span></code> in this case), and
we&#8217;d like for our operation to be agnostic to the platform on which it is
running.</p>
</div>
</div>
<div class="section" id="python-filter">
<h2><a class="toc-backref" href="#id4">Python Filter</a><a class="headerlink" href="#python-filter" title="Permalink to this headline">¶</a></h2>
<p>Through the use of the <a class="reference internal" href="../stages/filters.python.html#filters-python"><span class="std std-ref">filters.python</span></a>, PDAL allows the use of Python and
<a class="reference external" href="http://www.numpy.org/">NumPy</a> to process point cloud data. This can be very useful in prototyping
situations, where PDAL can provide convenient data access and the processing
logic of software that is still taking shape can be constructed with the rapid
prototyping tools that Python can provide.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">mad</span><span class="p">(</span><span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">):</span>

    <span class="c1"># Fetch the Y dimension, which has our outliers</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">ins</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">]</span>

    <span class="c1"># Let numpy compute median</span>
    <span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="c1"># Let numpy compute stddev</span>
    <span class="n">stddev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="c1"># Identify points that are &gt; 3 stddev</span>
    <span class="n">indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">median</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">*</span><span class="n">stddev</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Stuff our output in a dictionary</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">output</span><span class="p">[</span><span class="s1">&#39;median&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">median</span>
    <span class="n">output</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stddev</span>
    <span class="n">output</span><span class="p">[</span><span class="s1">&#39;indexes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">])</span>
    <span class="n">output</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">]</span>

    <span class="c1"># Print our dict to stdout</span>
    <span class="k">print</span> <span class="n">output</span>

    <span class="c1"># filters.python must return True to tell</span>
    <span class="c1"># PDAL it successfully completed</span>
    <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="pdal-pipeline">
<h2><a class="toc-backref" href="#id5">PDAL Pipeline</a><a class="headerlink" href="#pdal-pipeline" title="Permalink to this headline">¶</a></h2>
<p>Our pipeline to apply the filter is straightforward. Because we are going to be
processing the data with a Bash script, we&#8217;ll use some substitution to push
our filename (taken from an argument on the command line) and our script itself.
There is nothing much interesting except for the fact that we substitute our
filename in its own entry so PDAL can figure out which driver to read it with.
This will allow our script to work with any format PDAL can identify.</p>
<div class="highlight-json"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;pipeline&quot;</span><span class="p">:[</span>
    <span class="s2">&quot;/data/$filename&quot;</span><span class="p">,</span>
    <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;filters.python&quot;</span><span class="p">,</span>
    <span class="nt">&quot;function&quot;</span><span class="p">:</span><span class="s2">&quot;mad&quot;</span><span class="p">,</span>
    <span class="nt">&quot;module&quot;</span><span class="p">:</span><span class="s2">&quot;anything&quot;</span><span class="p">,</span>
    <span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="s2">&quot;$script&quot;</span>
    <span class="p">}</span>  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="docker">
<h2><a class="toc-backref" href="#id6">Docker</a><a class="headerlink" href="#docker" title="Permalink to this headline">¶</a></h2>
<p>As I mentioned before, we want to run this script using Docker so we have
consistent versioning and so we can use the script in the same way across
a bunch of machines. To run the command in Docker we need to do two things:</p>
<ol class="arabic simple">
<li>Start a Docker container with the PDAL Docker container tag (<code class="docutils literal"><span class="pre">pdal/pdal:1.5</span></code> in this case)</li>
<li>Run our command on that image once it is running.</li>
</ol>
<p><code class="docutils literal"><span class="pre">docker</span> <span class="pre">run</span></code> outputs the SHA of the container instance it is running to STDIN. We
will capture that and then run our <code class="docutils literal"><span class="pre">pdal</span> <span class="pre">pipeline</span></code> command on it.</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span><span class="c1"># Start the container</span>
<span class="nv">container</span><span class="o">=</span><span class="k">$(</span>docker run -it -d -v <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>:/data pdal/pdal:1.5<span class="k">)</span>

<span class="c1"># Echo our pipeline into it and run pdal pipeline on it</span>
<span class="nv">output</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$pipeline</span> <span class="p">|</span> docker <span class="nb">exec</span> -i <span class="nv">$container</span> pdal pipeline -i STDIN<span class="k">)</span>

<span class="c1"># redirect stderr and stdout to null. We don&#39;t want to know which ID</span>
<span class="c1"># was killed.</span>
docker <span class="nb">kill</span> <span class="nv">$container</span> <span class="p">&amp;</span>&gt; /dev/null
</pre></div>
</div>
</div>
<div class="section" id="final-script">
<h2><a class="toc-backref" href="#id7">Final Script</a><a class="headerlink" href="#final-script" title="Permalink to this headline">¶</a></h2>
<p>Here&#8217;s our final script. The junk from lines 53-66 are to get bash to do variable
substitution into our <a class="reference internal" href="../pipeline.html#pipeline"><span class="std std-ref">Pipeline</span></a> <a class="reference external" href="https://en.wikipedia.org/wiki/JSON">JSON</a> without breaking its syntax doing double
quote and newline substitution.</p>
<p>Using our script, we can now identify which points have <code class="docutils literal"><span class="pre">Y</span></code> dimensions greater than
three standard deviations:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ ./run.sh bad-y-values.las
{&#39;values&#39;: [22940882.882926211, 18747910.56323766], &#39;median&#39;: 4322652.908885533, &#39;stddev&#39;: 8292.74344366484, &#39;indexes&#39;: [1375302, 1376129]}
</pre></div>
</div>
<div class="highlight-shell"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nv">filename</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>

<span class="nb">read</span> -d <span class="s1">&#39;&#39;</span> script &lt;&lt;<span class="s2">&quot;EOF&quot;</span>

import numpy as np

def mad<span class="o">(</span>ins, outs<span class="o">)</span>:

    <span class="c1"># Fetch the Y dimension, which has our outliers</span>
    <span class="nv">y</span> <span class="o">=</span> ins<span class="o">[</span><span class="s2">&quot;Y&quot;</span><span class="o">]</span>

    <span class="c1"># Let numpy compute median</span>
    <span class="nv">median</span> <span class="o">=</span> np.median<span class="o">(</span>y<span class="o">)</span>

    <span class="c1"># Let numpy compute stddev</span>
    <span class="nv">stddev</span> <span class="o">=</span> np.std<span class="o">(</span>y<span class="o">)</span>

    <span class="c1"># Identify points that are &gt; 3 stddev</span>
    <span class="nv">indexes</span> <span class="o">=</span> np.where<span class="o">(</span> abs<span class="o">(</span>y-median<span class="o">)</span> &gt; <span class="m">3</span>*stddev<span class="o">)[</span><span class="m">0</span><span class="o">]</span>

    <span class="c1"># Stuff our output in a dictionary</span>
    <span class="nv">output</span> <span class="o">=</span> <span class="o">{}</span>
    output<span class="o">[</span><span class="s1">&#39;median&#39;</span><span class="o">]</span> <span class="o">=</span> median
    output<span class="o">[</span><span class="s1">&#39;stddev&#39;</span><span class="o">]</span> <span class="o">=</span> stddev
    output<span class="o">[</span><span class="s1">&#39;indexes&#39;</span><span class="o">]</span> <span class="o">=</span> list<span class="o">([</span>v <span class="k">for</span> v in indexes<span class="o">])</span>
    output<span class="o">[</span><span class="s1">&#39;values&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span>y<span class="o">[</span>i<span class="o">]</span> <span class="k">for</span> i in indexes<span class="o">]</span>

    <span class="c1"># Print our dict to stdout</span>
    print output

    <span class="c1"># filters.python must return True to tell</span>
    <span class="c1"># PDAL it successfully completed</span>
    <span class="k">return</span> True

EOF

<span class="nb">read</span> -d <span class="s1">&#39;&#39;</span> pipeline &lt;&lt;<span class="s2">&quot;EOF&quot;</span>
<span class="o">{</span>
  <span class="s2">&quot;pipeline&quot;</span>:<span class="o">[</span>
    <span class="s2">&quot;/data/</span><span class="nv">$filename</span><span class="s2">&quot;</span>,
    <span class="o">{</span>
    <span class="s2">&quot;type&quot;</span> : <span class="s2">&quot;filters.python&quot;</span>,
    <span class="s2">&quot;function&quot;</span>:<span class="s2">&quot;mad&quot;</span>,
    <span class="s2">&quot;module&quot;</span>:<span class="s2">&quot;anything&quot;</span>,
    <span class="s2">&quot;source&quot;</span>:<span class="s2">&quot;</span><span class="nv">$script</span><span class="s2">&quot;</span>
    <span class="o">}</span>  <span class="o">]</span>
<span class="o">}</span>
EOF


<span class="c1"># Do a bunch of bash vomit to properly substitute</span>
<span class="c1"># in our $filename and $script variables into the pipeline</span>
<span class="c1"># variable</span>
<span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;%&quot;</span>

<span class="c1"># echo newlines</span>
<span class="nv">script</span><span class="o">=</span><span class="k">$(</span>awk <span class="s1">&#39;{printf &quot;%s\\n&quot;, $0}&#39;</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">&quot;</span><span class="nv">$script</span><span class="s2">&quot;</span><span class="k">)</span>

<span class="c1"># replace &quot; with \&quot;</span>
<span class="nv">script</span><span class="o">=</span><span class="k">$(</span>sed  <span class="s1">&#39;s/[&quot;]/\\&amp;/g&#39;</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">&quot;</span><span class="nv">$script</span><span class="s2">&quot;</span><span class="k">)</span>

<span class="nv">pipeline</span><span class="o">=</span><span class="k">$(</span>awk <span class="s1">&#39;{printf &quot;%s&quot;, $0}&#39;</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">&quot;</span><span class="nv">$pipeline</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="nv">pipeline</span><span class="o">=</span><span class="k">$(</span>sed  <span class="s1">&#39;s/[&quot;]/\\&amp;/g&#39;</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">&quot;</span><span class="nv">$pipeline</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="nv">pipeline</span><span class="o">=</span><span class="k">$(</span><span class="nb">eval</span> <span class="nb">echo</span> <span class="nv">$pipeline</span><span class="k">)</span>


<span class="c1"># Start the container</span>
<span class="nv">container</span><span class="o">=</span><span class="k">$(</span>docker run -it -d -v <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>:/data pdal/pdal:1.5<span class="k">)</span>

<span class="c1"># Echo our pipeline into it and run pdal pipeline on it</span>

<span class="nv">output</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$pipeline</span> <span class="p">|</span> docker <span class="nb">exec</span> -i <span class="nv">$container</span> pdal pipeline -i STDIN<span class="k">)</span>

<span class="c1"># redirect stderr and stdout to null. We don&#39;t want to know which ID</span>
<span class="c1"># was killed.</span>
docker <span class="nb">kill</span> <span class="nv">$container</span> <span class="p">&amp;</span>&gt; /dev/null
</pre></div>
</td></tr></table></div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../workshop/index.html" class="btn btn-neutral float-right" title="Point Cloud Processing and Analysis with PDAL" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="sampling/index.html" class="btn btn-neutral" title="Performing Poisson Sampling of Point Clouds Using Dart Throwing" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
                    &copy;  2017
                        <a href="http://github.com/hobu">Howard Butler</a>,
                        <a href="http://github.com/mpgerlek">Michael Gerlek</a>,
                        and
                        <a href="https://github.com/PDAL/PDAL/graphs/contributors">others</a>.
      Last updated on Oct 13, 2017.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.6.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
    <div class="footer">
        <div class="container">
                    &copy;  2017
                        <a href="http://github.com/hobu">Howard Butler</a>,
                        <a href="http://github.com/mpgerlek">Michael Gerlek</a>,
                        and
                        <a href="https://github.com/PDAL/PDAL/graphs/contributors">others</a>,
                Last updated
                    on Oct 13, 2017.
        </div>
    </div>

</body>
</html>